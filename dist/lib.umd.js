!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("prop-types"),require("escape-string-regexp"),require("@emotion/styled"),require("@emotion/react"),require("styled-system"),require("@emotion/css"),require("react-textarea-autosize")):"function"==typeof define&&define.amd?define(["exports","react","prop-types","escape-string-regexp","@emotion/styled","@emotion/react","styled-system","@emotion/css","react-textarea-autosize"],t):t((e||self).reactQueryAssist={},e.react,e.propTypes,e.escapeStringRegexp,e.styled,e.react,e.styledSystem,e.css,e.reactTextareaAutosize)}(this,function(e,t,n,o,s,i,r,a,l){function d(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var u,p,h,c,f,g,b,m,y,v,w,x=/*#__PURE__*/d(t),C=/*#__PURE__*/d(n),k=/*#__PURE__*/d(o),S=/*#__PURE__*/d(s),E=/*#__PURE__*/d(l);function K(){return K=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},K.apply(this,arguments)}function A(e,t){return t||(t=e.slice(0)),e.raw=t,e}function P(e,t){return new RegExp(k.default(e||""),"i").test(t||"")}function O(e){void 0===e&&(e={});const t=e.partial?"*":"+";return new RegExp("(?!^|\\(|\\s)*([-]+)?([\\w.$]+)"+(e.partial?"?":"")+":"+(e.partial?"?":"")+'(?!:)([><=]*)(?:(")(.'+t+'?)(\\*)?"|([^\\s()*"]'+t+"))"+(e.partial?"?":"")+"(\\*)?(?!\\s|\\)|$)*","g")}function V(e,t,n){void 0===t&&(t=[]),void 0===n&&(n=[]);const o=Array.isArray(e)?e:O({partial:!0}).exec(e);if(!o||!o.length)return{};const s={fullToken:o[0],attributeName:o[2],attributeNameValid:!1,attributeValue:o[5]||o[7],attributeValueValid:!1,prepended:o[1]||"",operator:o[3],negated:o[0].indexOf("-")>-1,quoted:Boolean(o[4]),wildcard:Boolean(o[6]||o[8])};if(t){const e=t.find(e=>{let t=!1;for(const i of n)if(o=s.attributeName,new RegExp("^"+k.default(e[i]||"")+"$","i").test(o||"")){t=!0;break}var o;return t});e&&(s.attributeNameValid=!0,s.attributeValueValid=!0,Array.isArray(e.enumerations)&&(s.attributeValueValid=e.enumerations.findIndex(e=>P(s.attributeValue,e))>-1))}return s}const F=i.keyframes(u||(u=A(["\n  0% {\n    opacity: 0;\n    transform: perspective(50em) rotateX(-30deg);\n  }\n  100% {\n    opacity: 1;\n    transform: perspective(50em) rotateX(0deg);\n  }\n"]))),D=S.default("aside")(p||(p=A(["\n    display: inline-block;\n    position: absolute;\n    z-index: 10;\n    transform-origin: 50% 0;\n    animation: "," ease-in-out 250ms;\n    transition: top 100ms, left 100ms;\n\n    ","\n    ","\n  ","\n  ","\n  ","\n  ","\n  ","\n  ","\n  ","\n  ","\n  ","\n  ","\n  ","\n  ","\n  ","\n"])),F,r.top,r.left,r.color,r.boxShadow,r.borders,r.borderColor,r.borderRadius,r.space,r.width,r.minWidth,r.fontSize,r.fontWeight,r.fontFamily,r.lineHeight,r.letterSpacing);D.defaultProps={bg:"#555555",boxShadow:"0 4px 10px rgba(0, 0, 0, .25)",color:"#FFFFFF",minWidth:"280px"};const T=S.default("section")(h||(h=A(["\n    padding: 15px;\n    text-align: ",";\n    :not(:last-child) {\n        border-bottom: 1px solid rgba(255, 255, 255, 0.15);\n    }\n"])),e=>e.center?"center":"inherit"),I=S.default("ul")(c||(c=A(["\n    list-style-type: none;\n    line-height: 20px;\n    margin: 10px 0;\n    overflow: auto;\n    padding-inline-start: 0;\n\n    ","\n    ","\n  ","\n  ","\n"])),r.space,r.color,r.borders,r.maxHeight);I.defaultProps={maxHeight:"200px"};const j=S.default("li")(f||(f=A(["\n    cursor: pointer;\n    border: 1px solid transparent;\n    overflow: hidden;\n    text-overflow: ellipsis;\n\n    ","\n    ","\n\n  ","\n  ","\n  ","\n"])),r.space,r.maxWidth,e=>e.active&&r.color,e=>e.active&&r.borders,e=>e.active&&r.borderColor);j.defaultProps={bg:"#FFFFFF",color:"#000000",p:"3px 15px",maxWidth:"320px"};const H=S.default(T)(g||(g=A(["\n    padding: 15px 0;\n"]))),R=S.default("div")(b||(b=A(["\n    display: inline-block;\n    background: ",";\n    font-weight: 500;\n    line-height: 18px;\n    padding: 5px 10px;\n    cursor: pointer;\n    &:hover {\n        background: rgba(255, 255, 255, 0.1);\n    }\n"])),e=>e.active?"rgba(255, 255, 255, 0.2)":"none"),_=S.default(R)(m||(m=A(["\n    display: block;\n    margin-bottom: 5px;\n"]))),L=S.default("div")(y||(y=A(["\n    display: inline-block;\n    background: rgba(255, 255, 255, 0.1);\n    border-radius: 2px;\n    font-size: 12px;\n    font-weight: 700;\n    line-height: 18px;\n    min-width: 20px;\n    text-align: center;\n    vertical-align: middle;\n    padding: 2px 5px;\n    margin-right: 5px;\n"]))),N=S.default(L)(v||(v=A(["\n    background: none;\n    border: 1px solid ",";\n    color: ",";\n    font-size: 8px;\n    padding: 0;\n    width: ",";\n    height: 18px;\n"])),e=>e.theme.color,e=>e.theme.color,e=>e.long?"36px":"18px"),z=S.default("div")(w||(w=A(["\n    display: inline-block;\n    opacity: 0.5;\n    &:not(:last-child) {\n        margin-right: 15px;\n    }\n"])));class q extends t.PureComponent{constructor(e){super(e),this.onKeyDown=this.onKeyDown.bind(this),this.handleEnterKey=this.handleEnterKey.bind(this),this.handleEscKey=this.handleEscKey.bind(this),this.handleArrowKeys=this.handleArrowKeys.bind(this),this.adjustListScroll=this.adjustListScroll.bind(this),this.getAttribute=this.getAttribute.bind(this),this.getSuggestions=this.getSuggestions.bind(this),this.getSuggestionAddons=this.getSuggestionAddons.bind(this),this.filterSuggestions=this.filterSuggestions.bind(this),this.acceptSuggestion=this.acceptSuggestion.bind(this),this.getOperators=this.getOperators.bind(this),this.setOperator=this.setOperator.bind(this),this.state={suggestions:[],highlightedIdx:0,selectedIdx:null,prepended:"",operator:"",negated:!1}}componentDidMount(){this.filterSuggestions(this.props.value),this.props.keyboardHelpers&&document.addEventListener("keydown",this.onKeyDown,!1)}componentWillUnmount(){this.props.keyboardHelpers&&document.removeEventListener("keydown",this.onKeyDown,!1)}componentWillReceiveProps(e){this.props.value!==e.value&&this.filterSuggestions(e.value)}componentDidUpdate(){0===this.state.suggestions.length&&this.props.onClose()}onKeyDown(e){switch(e.keyCode){case 9:case 13:this.handleEnterKey(e);break;case 27:this.handleEscKey(e);break;case 38:case 40:this.handleArrowKeys(e,e.keyCode)}}handleEnterKey(e){e.preventDefault(),this.acceptSuggestion()}handleEscKey(e){e.preventDefault(),this.props.onClose(!0)}handleArrowKeys(e,t){e.preventDefault();const{highlightedIdx:n}=this.state,o=40===t,s=this.state.suggestions.length-1,i=null!==n?o?n+1:n-1:o?0:s;this.setState({highlightedIdx:o?i<=s?i:0:i>=0?i:s},this.adjustListScroll)}adjustListScroll(){const{offsetTop:e,clientHeight:t}=this._selected,{scrollTop:n,clientHeight:o}=this._list,s=t,i=o-t,r=e-n;r>i?this._list.scrollTop+=t+(r-i):r<s&&(this._list.scrollTop=e-t+(r-s))}getAttribute(e){if(null!==e&&e>-1)return this.props.attributes[e]}getSuggestions(e){const{nameKey:t,attributes:n}=this.props;return e?e.enumerations||[]:n.map(e=>e[t])}getSuggestionAddons(e,t){const n=[];return e&&(t.wildcard||e.enumerations||!t.attributeValue||"string"!==e.type||n.push('"'+t.attributeValue+'"'),t.attributeValue&&"string"===e.type&&(t.quoted&&!e.enumerations?n.push('"'+t.attributeValue+'*"'):n.push("*"+t.attributeValue+"*",t.attributeValue+"*","*"+t.attributeValue))),n}filterSuggestions(e){const{nameKey:t,attributes:n}=this.props,o=V(e),s=o.attributeName&&e.indexOf(":")>-1?n.findIndex(e=>e[t]===o.attributeName):-1,i=this.getAttribute(s),r=this.getSuggestions(i),a=s>-1?o.attributeValue:o.attributeName,l=r.filter(e=>P(a,e)).concat(this.getSuggestionAddons(i,o));this.setState({selectedIdx:s,prepended:o.prepended,operator:o.operator,negated:o.negated,suggestions:l,highlightedIdx:0})}acceptSuggestion(){const{nameKey:e,onSelect:t}=this.props,{suggestions:n,highlightedIdx:o,selectedIdx:s,prepended:i,operator:r}=this.state,a=this.getAttribute(s),l=n[o];t(""+i+(a?a[e]+":"+r+l:l),-1===s?":":"")}getOperators(){const e=[],t=this.getAttribute(this.state.selectedIdx);if(t)switch(t.type){case"int":case"float":e.push({name:"GT",char:">",active:">"===this.state.operator}),e.push({name:"LT",char:"<",active:"<"===this.state.operator}),e.push({name:"GTE",char:">=",active:">="===this.state.operator}),e.push({name:"LTE",char:"<=",active:"<="===this.state.operator})}return e}setOperator(e){const{value:t}=this.props,{negated:n,operator:o}=this.state;if("-"===e){const e=t.replace(/^-?(.*)/,(n?"":"-")+"$1");this.props.onSelect(e)}else{const n=V(t);n.operator=o===e?"":e,this.props.onSelect(function(e){const{prepended:t="",attributeName:n="",attributeValue:o="",operator:s=""}=e||{};return""+t+n+":"+s+o}(n))}}render(){const e=this.props.footerComponent;/*#__PURE__*/return x.default.createElement(D,K({left:this.props.offsetX||0,top:this.props.offsetY||0},this.props.dropdownProps,{"data-testid":"dropdown"}),/*#__PURE__*/x.default.createElement(I,K({},this.props.listProps,{ref:e=>this._list=e}),this.state.suggestions.map((e,t)=>{const n=this.state.highlightedIdx===t;/*#__PURE__*/return x.default.createElement(j,K({key:t,active:n,onClick:this.acceptSuggestion,onMouseOver:()=>this.setState({highlightedIdx:t}),ref:n?e=>this._selected=e:void 0},this.props.selectorProps),e)})),/*#__PURE__*/x.default.createElement(H,null,/*#__PURE__*/x.default.createElement(_,{active:this.state.negated,onClick:()=>this.setOperator("-")},/*#__PURE__*/x.default.createElement(L,null,"-"),this.props.translations&&this.props.translations.negate?this.props.translations.negate:"NEGATE"),this.getOperators().map((e,t)=>/*#__PURE__*/x.default.createElement(R,{key:t,active:e.active,onClick:()=>this.setOperator(e.char)},/*#__PURE__*/x.default.createElement(L,null,e.char),e.name))),this.props.keyboardHelpers&&/*#__PURE__*/x.default.createElement(T,{center:!0},/*#__PURE__*/x.default.createElement(z,null,/*#__PURE__*/x.default.createElement(N,null,"▲"),/*#__PURE__*/x.default.createElement(N,null,"▼"),this.props.translations&&this.props.translations.navigate?this.props.translations.navigate:"to navigate"),/*#__PURE__*/x.default.createElement(z,null,/*#__PURE__*/x.default.createElement(N,{long:!0},"↵"),this.props.translations&&this.props.translations.select?this.props.translations.select:"to select")),/*#__PURE__*/x.default.createElement(e,null))}}q.propTypes={value:C.default.string,nameKey:C.default.string,attributes:C.default.array,onSelect:C.default.func,onClose:C.default.func,offsetX:C.default.number,offsetY:C.default.number,keyboardHelpers:C.default.bool,footerComponent:C.default.func,dropdownProps:C.default.object,selectorProps:C.default.object,listProps:C.default.object,translations:C.default.object},q.defaultProps={value:"",nameKey:"name",onSelect:()=>{},onClose:()=>{},keyboardHelpers:!0,footerComponent:()=>null};class B extends t.Component{constructor(e){super(e),this.wrapperRef=/*#__PURE__*/x.default.createRef(),this.handleClickOutside=this.handleClickOutside.bind(this)}componentDidMount(){document.addEventListener("mousedown",this.handleClickOutside)}componentWillUnmount(){document.removeEventListener("mousedown",this.handleClickOutside)}handleClickOutside(e){this.wrapperRef&&!this.wrapperRef.current.contains(e.target)&&this.props.notify&&this.props.notify()}render(){/*#__PURE__*/return x.default.createElement("div",{ref:this.wrapperRef},this.props.children)}}var W,X,Y,$,M,U,G;const Q=S.default("div")(W||(W=A(["\n    position: relative;\n    width: 100%;\n"]))),J=S.default("div")(X||(X=A(["\n    position: relative;\n    ","\n    ","\n  ","\n  ","\n  ","\n  ","\n  ","\n  ","\n  ","\n  ","\n  ","\n  ","\n  ","\n"])),r.space,r.width,r.borders,r.borderColor,r.borderRadius,r.boxShadow,r.color,r.fontSize,r.fontWeight,r.fontFamily,r.lineHeight,r.letterSpacing,r.textAlign);J.defaultProps={bg:"#FFFFFF",color:"#505050",border:"1px solid rgba(0, 0, 0, .1)",fontFamily:"monospace"};const Z=E.default,ee=r.style({prop:"placeholderColor",cssProperty:"color",key:"colors"}),te=S.default(Z)(Y||(Y=A(["\n    display: block;\n    background: none;\n    border: none;\n    outline: none;\n    resize: none;\n    font: inherit;\n    width: 100%;\n    padding: 0;\n    white-space: pre-wrap;\n    word-wrap: break-word;\n    /* we only want overlay text visible */\n    /* need to do this so caret still shows up */\n    color: inherit;\n    -webkit-text-fill-color: transparent;\n    ::placeholder {\n        ","\n        -webkit-text-fill-color: initial;\n    }\n"])),ee);te.defaultProps={lineHeight:"1.1rem",placeholderColor:"#D7D7D7"};const ne=S.default("div")($||($=A(["\n    display: block;\n    background: none;\n    border: none;\n    outline: none;\n    resize: none;\n    font: inherit;\n    max-width: 100%;\n    padding: 0;\n    white-space: pre-wrap;\n    word-wrap: break-word;\n    position: absolute;\n    top: 0;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    pointer-events: none;\n    padding: inherit;\n\n    ","\n\n    /* reversed from Input above */\n  -webkit-text-fill-color: initial;\n"])),e=>e.collapsed&&a.css(M||(M=A(["\n            overflow: hidden;\n            white-space: nowrap;\n            text-overflow: ellipsis;\n        "])))),oe=S.default("span")(U||(U=A(["\n    font: inherit;\n"]))),se=r.style({prop:"tokenColor",cssProperty:"color",key:"colors"}),ie=S.default(oe)(G||(G=A(["\n    position: relative;\n    cursor: pointer;\n    font-weight: 500;\n\n    ","\n"])),se);ie.defaultProps={tokenColor:"#2384FF"};class re extends t.Component{constructor(e){super(e),this.onFocus=this.onFocus.bind(this),this.onBlur=this.onBlur.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onChange=this.onChange.bind(this),this.onAutosuggest=this.onAutosuggest.bind(this),this.onSelectValue=this.onSelectValue.bind(this),this.handleEnterKey=this.handleEnterKey.bind(this),this.shouldAutosuggest=this.shouldAutosuggest.bind(this),this.onClose=this.onClose.bind(this),this.extract=this.extract.bind(this),this.getCurrentChunk=this.getCurrentChunk.bind(this),this.buildOverlay=this.buildOverlay.bind(this),this.state={focused:!1,value:e.defaultValue,attributes:e.data,overlayComponents:[],dropdownClosed:!1,dropdownOpen:!1,dropdownValue:null,dropdownX:null,dropdownY:null}}componentDidMount(){this.setState({overlayComponents:this.buildOverlay(this.state.value)})}componentDidUpdate(e,t){const{value:n,attributes:o}=this.state;n!==t.value&&this.props.onChange(n),n===t.value&&o.length===t.attributes.length||this.setState({overlayComponents:this.buildOverlay(n)},this.onAutosuggest)}componentWillReceiveProps(e){const t={};void 0!==e.defaultValue&&(t.value=e.defaultValue),e.data&&(t.attributes=e.data),this.setState(t)}onFocus(e){this.setState({focused:!0},this.onAutosuggest)}onBlur(e){this.setState({focused:!1})}onKeyDown(e){13===e.keyCode&&this.handleEnterKey(e),37!==e.keyCode&&39!==e.keyCode||this.onClose()}onChange(e){this.setState({value:e.target.value})}onAutosuggest(){const{value:e}=this.state,{offsetLeft:t,offsetTop:n}=this._marker,{chunk:o}=this.getCurrentChunk(e),s=this.shouldAutosuggest(o);this.setState(s?{dropdownClosed:!1,dropdownOpen:!0,dropdownValue:o,dropdownX:t,dropdownY:n+25}:{dropdownOpen:!1})}onSelectValue(e,t){void 0===t&&(t="");const{value:n}=this.state,{index:o,indexEnd:s}=this.getCurrentChunk(n),i=n.slice(0,o),r=n.slice(s),a=o+e.length+t.length;this.setState({value:""+i+e+t+r,dropdownClosed:":"!==t},()=>{this._input.focus(),this._input.setSelectionRange(a,a)})}handleEnterKey(e){const t=document.activeElement===this._input;e.shiftKey||!t||this.state.dropdownOpen||(e.preventDefault(),this.props.onSubmit(this.state.value),e.target.blur())}shouldAutosuggest(e){const{selectionStart:t}=this._input,{value:n,focused:o}=this.state,s=!n.charAt(t)||/[)\s]/.test(n.charAt(t)),i=s&&/[\s-(]/.test(n.charAt(t-1)),r=s&&/[^)\s]/.test(n.charAt(t-1));return o&&(!n||i||r&&!this.state.dropdownClosed)}onClose(e){this.setState({dropdownOpen:!1,dropdownClosed:e||!1})}extract(e){const{nameKeyIncludes:t}=this.props,{attributes:n}=this.state;return function(e,t,n){const o=[],s=O();let i;for(;null!==(i=s.exec(e));){if(t){const e=V(i,t,n);if(!e.attributeNameValid||!e.attributeValueValid)continue}o.push([i.index,s.lastIndex])}return o}(e,n,t)}getCurrentChunk(e){const{selectionStart:t}=this._input,n=this.extract(e),o=e.substring(0,t),s=o.match(/[^\s]*$/),i=s?o.lastIndexOf(s[s.length-1]):-1;let r=i;for(const[e,o]of n.reverse()){if(t>o&&i<e){r=o;break}if(t>e&&t<=o){r=e;break}if(i>e&&i<o){r=o;break}}const a=e.substring(r,t);return{index:r,indexEnd:r+a.length,chunk:a}}buildTokens(e,t){const n=[],o=this.extract(e);let s=0;return o.reduce((t,o)=>(n.push(e.substring(t[1],o[0])),n.push(/*#__PURE__*/x.default.createElement(ie,{key:"token-"+o[0],tokenColor:this.props.inputProps.tokenColor},e.substring(o[0],o[1]))),s=o[1],o),[null,0]),n.push(e.substring(s)),n.filter(Boolean)}buildOverlay(e){const{index:t}=this.getCurrentChunk(e),n=this.buildTokens(e.substring(0,t)),o=this.buildTokens(e.substring(t)||" ",t);return[n,/*#__PURE__*/x.default.createElement(oe,{key:"after-"+t,style:{outline:this.props.debug?"1px solid red":"none"},ref:e=>this._marker=e},o)]}render(){const{nameKey:e,className:t,inputProps:n,placeholder:o,keyboardHelpers:s,collapseOnBlur:i,footerComponent:r,dropdownProps:a,selectorProps:l,listProps:d,alwaysLeft:u,translations:p}=this.props,{value:h,attributes:c,dropdownOpen:f,dropdownValue:g,dropdownX:b,dropdownY:m,overlayComponents:y}=this.state,v=!this.state.focused&&i;/*#__PURE__*/return x.default.createElement(B,{notify:this.onClose},/*#__PURE__*/x.default.createElement(Q,{className:t},/*#__PURE__*/x.default.createElement(J,K({},n,{onClick:()=>this._input.focus()}),/*#__PURE__*/x.default.createElement(ne,{collapsed:v},y),/*#__PURE__*/x.default.createElement(te,{autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",autoFocus:n.autoFocus,maxRows:v?1:void 0,placeholder:o,placeholderColor:n.placeholderColor,value:h,onFocus:this.onFocus,onBlur:this.onBlur,onKeyDown:this.onKeyDown,onChange:this.onChange,ref:e=>this._input=e})),f&&/*#__PURE__*/x.default.createElement(q,{keyboardHelpers:s,footerComponent:r,attributes:c,value:g,nameKey:e,onSelect:this.onSelectValue,onClose:this.onClose,offsetX:u?0:b,offsetY:m,dropdownProps:a,selectorProps:l,listProps:d,translations:p})))}}re.propTypes={debug:C.default.bool,data:C.default.array,nameKey:C.default.string,nameKeyIncludes:C.default.array,defaultValue:C.default.string,placeholder:C.default.string,onChange:C.default.func,onSubmit:C.default.func,keyboardHelpers:C.default.bool,collapseOnBlur:C.default.bool,footerComponent:C.default.func,inputProps:C.default.object,dropdownProps:C.default.object,selectorProps:C.default.object,listProps:C.default.object,alwaysLeft:C.default.bool,translations:C.default.object},re.defaultProps={data:[],nameKey:"name",nameKeyIncludes:["name"],defaultValue:"",onChange:()=>{},onSubmit:()=>{},placeholder:"Search",inputProps:{},dropdownProps:{},selectorProps:{},listProps:{}},e.QueryAssist=re});
//# sourceMappingURL=lib.umd.js.map
